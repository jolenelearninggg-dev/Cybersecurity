# 資安事件處理流程學習筆記

## 一、基本概念與定義

### 1.1 核心術語

- **事件 (Event)**: 系統或網路中發生的任何動作
  - 例如: 使用者發送郵件、滑鼠點擊、防火牆允許連線請求

- **資安事件 (Incident)**: 具有負面後果的事件
  - 例如: 系統崩潰、未授權存取敏感資料、自然災害、電源故障

- **IT 資安事件**: 針對電腦系統有明確惡意意圖的事件
  - 資料竊取
  - 資金竊取
  - 未授權資料存取
  - 安裝和使用惡意軟體及遠端存取工具

- **事件處理 (Incident Handling)**: 一套明確定義的程序，用於管理和回應電腦或網路環境中的資安事件

### 1.2 事件處理的價值

- **快速有效的回應**: IT 資安事件經常涉及個人和商業資料的洩露
- **最小化損失**: 減少資訊竊取或服務中斷
- **系統化處理**: 訓練有素的團隊會系統性地回應，採取適當行動
- **優先級管理**: 不同嚴重程度的事件需要不同的資源分配

### 1.3 事件處理團隊結構

- **事件管理者 (Incident Manager)**: 
  - 通常由 SOC 經理、CISO/CIO 或可信任的第三方供應商擔任
  - 能夠指揮其他業務單位
  - 單一溝通點，追蹤調查期間採取的活動及完成狀態
  - 必須能及時獲取資訊或要求組織內任何員工執行活動

---

## 二、事件處理生命週期

### 2.1 四個主要階段

```
準備階段 (Preparation)
    ↓
偵測與分析階段 (Detection & Analysis)
    ↓
圍堵、根除與恢復階段 (Containment, Eradication & Recovery)
    ↓
事件後活動階段 (Post-Incident Activity)
    ↓ (循環回到準備階段)
```

**重要觀念**: 
- 事件處理人員大部分時間在前兩個階段
- 流程是循環的，非線性的
- 隨著新證據發現，下一步可能會改變
- 不可跳過步驟，完成一個階段才進入下一個

### 2.2 兩大主要活動

1. **調查 (Investigating)**
   - 發現初始受害者「零號病人」
   - 建立持續性事件時間軸
   - 確定攻擊者使用的工具和惡意軟體
   - 記錄受損系統及攻擊者的行為

2. **恢復 (Recovering)**
   - 建立並實施恢復計劃
   - 恢復正常業務運作
   - 對恢復的系統進行重點監控

---

## 三、Cyber Kill Chain (網路攻擊鏈)

### 3.1 七個階段

```
偵察 → 武器化 → 傳遞 → 漏洞利用 → 安裝 → 命令與控制 → 行動
```

#### 階段 1: 偵察 (Reconnaissance)
- **目的**: 選擇目標並收集資訊
- **被動偵察**: 
  - 從 LinkedIn、Instagram 等網路資源收集資訊
  - 查看組織網頁文件
  - 職缺廣告和合作夥伴資訊 (揭露使用的技術)
- **主動偵察**:
  - 掃描外部網頁應用程式和 IP 位址
  - 識別開放埠口
  - 識別服務
  - 繪製整個網路地圖

#### 階段 2: 武器化 (Weaponization)
- 開發用於初始存取的惡意軟體
- 嵌入漏洞利用或可傳遞的 payload
- 特點:
  - 極輕量化
  - 無法被防毒和偵測工具發現
  - 針對目標組織的防護技術量身打造
  - 目的: 提供遠端存取、持久化、部署額外工具

#### 階段 3: 傳遞 (Delivery)
- **傳統方式**:
  - 釣魚郵件 (含惡意附件或連結)
  - 網頁掛馬
  - 仿冒網站 (竊取憑證)
- **社交工程**:
  - 電話詐騙
  - 託管在攻擊者控制的仿冒網站
- **物理傳遞**:
  - USB 隨身碟
  - 刻意遺留的儲存裝置

#### 階段 4: 漏洞利用 (Exploitation)
- 觸發漏洞利用或傳遞的 payload
- 嘗試在目標系統上執行程式碼以獲取存取或控制

#### 階段 5: 安裝 (Installation)
- 初始 stager 在受損機器上執行
- **常見技術**:
  - **Droppers**: 傳遞並安裝惡意軟體的小型程式碼
  - **Backdoors**: 提供持續存取的後門
  - **Rootkits**: 隱藏惡意軟體存在，規避偵測

#### 階段 6: 命令與控制 (Command & Control, C2)
- 建立對受損機器的遠端存取能力
- 使用模組化 stager 動態載入額外腳本
- 進階團隊會使用多個工具變體確保持久性

#### 階段 7: 行動/目標 (Action/Objective)
- **目標可能包括**:
  - 竊取機密資料
  - 獲取網路最高權限
  - 部署勒索軟體

**重要觀念**: 攻擊者不會線性操作，某些階段會重複多次。例如安裝成功後會再次進行偵察，尋找更多目標。

### 3.2 防禦目標
**目標**: 在最早階段阻止攻擊者進展

---

## 四、MITRE ATT&CK 框架

### 4.1 框架概述

- **定義**: 基於矩陣的知識庫，記錄攻擊者的戰術和技術
- **結構**: 
  - 欄位 = 戰術 (Tactics) - 攻擊者的高階目標
  - 儲存格 = 技術 (Techniques) - 達成目標的具體方法

### 4.2 核心概念

#### 戰術 (Tactic)
高階攻擊目標，例如:
- 初始存取 (Initial Access)
- 持久化 (Persistence)
- 權限提升 (Privilege Escalation)

#### 技術 (Technique)
達成戰術的具體方法，例如:
- **T1105** - Ingress Tool Transfer (工具傳輸)
  - 使用 wget、curl 等工具下載
- **T1021** - Remote Services (遠端服務)
  - 使用 SSH、RDP、SMB 進行橫向移動

#### 子技術 (Sub-technique)
技術的具體實作方式，例如:
- **T1003.001** - OS Credentials: LSASS Memory
  - 從 LSASS 程序記憶體傾印憑證
- **T1021.002** - Remote Services: SMB/Windows Admin Shares
  - 使用有效憑證與共享互動

### 4.3 痛苦金字塔 (Pyramid of Pain)

```
                    TTPs (最難更改)
                 ↗  ︙
              Tools  ︙
           ↗    ︙
    Network/Host Artifacts
      ↗       ︙
   Domain Names  ︙
    ↗         ︙
IP Addresses    ︙
  ↗          ︙
Hash Values (最容易更改)
```

**概念解釋**:
- **底層 (Hash/IP)**: 攻擊者容易更改，防禦效果低
- **中層 (Artifacts/Tools)**: 需要較多努力更改
- **頂層 (TTPs)**: 攻擊者最痛苦，需要根本改變操作方式

**偵測策略**:
- Hash/IP 偵測 = 容易規避
- TTP 偵測 (基於 MITRE) = 難以規避，防禦成熟度高

### 4.4 ATT&CK 應用

1. **分析事件**: 將觀察到的事件和指標映射到 ATT&CK 技術和戰術
2. **理解意圖**: 快速了解攻擊者意圖和可能的下一步
3. **警報優先級**: 基於針對高價值資產的技術排定優先級
4. **緩解措施**: 參考緩解和圍堵/根除行動

---

## 五、準備階段 (Preparation)

### 5.1 兩大目標

1. 建立組織內的事件處理能力
2. 透過適當保護措施防止 IT 資安事件

### 5.2 準備前提

#### 必備要素:
- ✓ 技術熟練的事件處理團隊成員
- ✓ 受過訓練的員工
- ✓ 明確的政策和文件
- ✓ 工具 (軟硬體)

### 5.3 明確的政策與文件

**應包含的最新資訊**:
- 事件處理團隊成員的聯絡資訊和角色
- 法律與合規部門聯絡資訊
- 管理團隊、IT 支援聯絡資訊
- 通訊與媒體關係部門
- 執法單位、ISP、設施管理、外部應變團隊
- 事件回應政策、計劃和程序
- 事件資訊共享政策和程序
- 系統和網路基準線
- 網路拓撲圖
- 全組織資產管理資料庫
- 高權限使用者帳號 (按需啟用)
- 緊急採購能力 (無需完整採購流程)
- 鑑識/調查備忘錄

### 5.4 事件記錄要點

**5W1H 原則**:
- Who (誰)
- What (什麼)
- When (何時)
- Where (何處)
- Why (為何)
- How (如何)

**記錄內容**:
- 時間戳記
- 執行的活動
- 活動結果
- 執行者

### 5.5 工具 (軟硬體)

#### 硬體設備:
- 額外筆電或鑑識工作站 (每位成員一台)
- 寫保護器 (Write Blockers)
- 鑑識用硬碟
- 電源線
- 螺絲起子、鑷子等維修工具
- 網路線和交換器

#### 軟體工具:
- 數位鑑識映像取得和分析工具
- 記憶體擷取和分析工具
- 即時回應擷取和分析工具
- 日誌分析工具
- 網路擷取和分析工具
- IOC 建立器和搜尋工具
- 監管鏈表單 (Chain of Custody)
- 加密軟體
- 票務追蹤系統
- 安全儲存和調查設施
- 獨立於組織基礎設施的事件處理系統

#### Jump Bag (快速反應包)
- 隨時準備好的工具包
- 可立即拿取使用
- 避免臨時收集工具的延遲

### 5.6 重要原則

- 文件系統完全獨立於組織基礎設施
- 假設整個網域已被入侵
- 所有系統可能無法使用
- 事件相關通訊應透過非組織系統的管道
- 假設攻擊者控制一切，可以讀取所有通訊

---

## 六、保護措施 (Prevention)

### 6.1 DMARC (電子郵件防護)

- **功能**: 防止釣魚郵件，建立在 SPF 和 DKIM 之上
- **作用**: 拒絕偽裝成組織員工的郵件
- **注意事項**: 
  - 易於實施且成本低
  - 必須徹底測試，避免阻擋合法郵件

### 6.2 端點強化 (Endpoint Hardening & EDR)

#### 推薦標準:
- CIS 基準
- Microsoft 基準

#### 重要措施:
- ✓ 停用 LLMNR/NetBIOS
- ✓ 實施 LAPS，移除一般使用者的管理權限
- ✓ 停用或配置 PowerShell 為「ConstrainedLanguage」模式
- ✓ 啟用攻擊面縮減 (ASR) 規則 (若使用 Microsoft Defender)
- ✓ 實施白名單
  - 至少阻止從使用者可寫資料夾執行 (Downloads、Desktop、AppData)
  - 阻止腳本類型: .hta, .vbs, .cmd, .bat, .js
  - 注意 LOLBin 檔案
- ✓ 使用主機防火牆
  - 阻止工作站對工作站通訊
  - 阻止對 LOLBins 的出站流量
- ✓ 部署 EDR 產品
  - 選擇整合 AMSI 的產品

### 6.3 網路保護

#### 網路分段:
- 防止入侵擴散到整個組織
- 隔離業務關鍵系統
- 僅允許業務必要的連線
- 內部資源不應直接面向網際網路 (除非置於 DMZ)

#### IDS/IPS 系統:
- 實施 SSL/TLS 攔截
- 基於內容識別惡意流量
- 不僅依賴 IP 聲譽

#### 裝置管理:
- 僅允許組織核准的裝置存取網路
- 使用 802.1x 減少 BYOD 風險
- 雲端環境: 使用條件存取政策 (如 Azure AD)

### 6.4 特權身分管理 / MFA / 密碼

#### 密碼策略:
- ❌ 弱但複雜的密碼: "Password1!" (可預測)
- ✓ 使用密碼短語: "i LIK3 my coffeE warm"
- ✓ 混用多種語言的詞彙

#### MFA (多因素驗證):
- 至少對所有管理存取實施 MFA
- 適用於所有應用程式和裝置

#### 特權帳號保護:
- 竊取特權憑證是 AD 環境中最常見的提權路徑
- 避免管理員帳號使用弱密碼或與一般帳號共用密碼

### 6.5 弱點掃描

- 持續對環境進行弱點掃描
- 至少修復「高」和「嚴重」級別弱點
- 無法修補時必須隔離脆弱系統

### 6.6 使用者意識訓練

- 訓練使用者識別可疑行為
- 顯著降低成功入侵的數量
- 定期「突襲」測試:
  - 每月釣魚郵件
  - 在辦公室掉落 USB 隨身碟

### 6.7 Active Directory 安全評估

#### 重要性:
- 從攻擊者角度尋找安全配置錯誤
- 消除容易的提權途徑
- AD 有多個已知提權路徑/漏洞
- 新漏洞經常被發現

#### 目標:
- 當端點被入侵時，攻擊者不應有一步提權的可能性
- 攻擊者產生越多額外工具和活動，被偵測的可能性越高

### 6.8 紫隊演練 (Purple Team Exercises)

#### 目的:
- 訓練事件處理人員
- 保持團隊參與度
- 在組織環境中進行實戰演練

#### 作法:
- 紅隊進行安全評估
- 持續或最終通知藍隊其行動和發現
- 識別可見性或安全缺陷

#### 效益:
- 識別組織弱點
- 測試藍隊防禦能力 (日誌、監控、偵測、回應)
- 未被發現的威脅 = 改進機會
- 被偵測的威脅 = 測試劇本和程序

---

## 七、偵測與分析階段 (Detection & Analysis)

### 7.1 偵測來源

威脅可能透過無限多種攻擊向量進入組織，偵測可能來自:
- 員工發現異常行為
- 工具警報 (EDR, IDS, Firewall, SIEM 等)
- 威脅狩獵活動
- 第三方通知

### 7.2 偵測層級

建議建立邏輯分層的偵測:
1. **網路邊界偵測** - 防火牆、網路 IDS/IPS、DMZ
2. **內部網路層級偵測** - 本地防火牆、主機 IDS/IPS
3. **端點層級偵測** - 防毒系統、EDR
4. **應用程式層級偵測** - 應用程式日誌、服務日誌

### 7.3 初始調查

#### 收集資訊:
- 事件被報告的日期/時間
- 誰偵測到事件？誰報告的？
- 如何偵測到事件？
- 事件是什麼？(釣魚？系統無法使用？)
- 受影響系統清單
- 誰存取過受影響的系統？採取了什麼行動？
- 這是持續性事件還是可疑活動已停止？

#### 系統資訊:
- 實體位置
- 作業系統
- IP 位址和主機名稱
- 系統擁有者
- 系統用途
- 系統當前狀態

#### 惡意軟體相關:
- IP 位址清單
- 偵測時間和日期
- 惡意軟體類型
- 受影響系統
- 惡意檔案匯出 (雜湊值、檔案副本等)

### 7.4 事件時間軸

#### 建立時間軸:
- 按事件發生時間排序
- 提供事件整體圖像
- 幫助判斷新證據是否屬於當前事件

#### 時間軸欄位:

| 日期 | 事件時間 | 主機名稱 | 事件描述 | 資料來源 |
|------|---------|---------|---------|---------|
| 09/09/2021 | 13:31 CET | SQLServer01 | 偵測到駭客工具 'Mimikatz' | 防毒軟體 |

**重點**: 
- 專注於攻擊者行為
- 記錄攻擊發生時間、網路連線建立時間、檔案下載時間
- 確保記錄活動被偵測的位置和相關系統

### 7.5 事件嚴重性與範圍問題

評估事件時應回答:
- 漏洞利用的影響是什麼？
- 漏洞利用的要求是什麼？
- 是否有業務關鍵系統受影響？
- 是否有建議的補救步驟？
- 有多少系統受到影響？
- 該漏洞是否在野外被利用？
- 該漏洞是否具有蠕蟲般的能力？

**注意**: 高影響事件將被立即處理，大量受影響系統的事件需要升級。

### 7.6 事件機密性與溝通

#### 機密原則:
- 所有收集的資訊應基於「需要知道」原則
- 除非法律或管理決策另有指示
- 攻擊者可能是公司員工
- 發生洩露時，對內外部的溝通應由指定人員依法律部門處理

#### 設定期望:
- 事件類型
- 可用證據來源
- 團隊調查所需時間的粗略估計
- 是否能夠揪出攻擊者
- 隨著調查進展保持利害關係人和管理層的知情

---

## 八、深入調查 (Investigation)

### 8.1 調查目的

**為什麼要了解事件如何發生？**
- 若不知道如何發生或什麼受到影響，補救措施無法確保攻擊者無法重複其行動
- 若確切知道攻擊者如何進入、使用什麼工具、哪些系統受影響，則可以規劃補救措施確保此攻擊路徑無法複製

### 8.2 三步驟循環過程

```
初始調查資料
    ↓
1. 建立和使用 IOCs
    ↓
2. 識別新線索和受影響系統
    ↓
3. 從新線索和受影響系統收集與分析資料
    ↓
(循環回到步驟 1)
```

### 8.3 指標入侵 (IOC - Indicator of Compromise)

#### 定義:
- 事件已發生的跡象
- 以結構化方式記錄，代表入侵的工件

#### 範例:
- IP 位址
- 檔案雜湊值
- 檔案名稱

#### IOC 標準與工具:
- **OpenIOC**: 特殊語言，用於記錄和分享 IOC
- **YARA**: 廣泛使用的 IOC 標準
- **Mandiant's IOC Editor**: 免費工具，可建立或編輯 IOC
- **STIX** (Structured Threat Information eXpression):
  - 開源、機器可讀的語言
  - 主要以 JSON 格式序列化
  - 用於交換網路威脅情報 (CTI)

#### STIX 範例:
```json
{
    "type": "file",
    "id": "file--474454e8-d393-5a4f-9069-19631ea9d397",
    "hashes": {
        "MD5": "40e609840ef3f7fea94d53998ec9f97f",
        "SHA-1": "141af6bcefdcf6b627425b5b2e02342c081e8d36",
        "SHA-256": "3461da3a2ddcced4a00f87dcd7650af48f97998a..."
    },
    "size": 13373,
    "name": "osvmhdfl.dll"
}
```

### 8.4 IOC 搜尋與使用

#### 部署方式:
- 部署 IOC 獲取/搜尋工具 (原生或第三方，可能需要大規模部署)
- Windows 環境常用 WMI 或 PowerShell 進行 IOC 相關操作

#### ⚠️ 重要注意事項 - 憑證快取:
- 連線到 (潛在) 受損系統時，必須格外小心防止高權限使用者憑證被快取
- 確保僅使用不會快取憑證的連線協定和工具 (如 WinRM)
- Windows Logon Type 3 (網路登入) 通常不會快取憑證

**PsExec 範例**:
- ❌ 使用明確憑證: 憑證會被快取在遠端機器
- ✓ 不使用憑證 (透過當前登入使用者的 session): 憑證不會被快取

### 8.5 識別新線索與受影響系統

#### 搜尋 IOC 後:
- 預期會有命中，揭示其他具有相同入侵跡象的系統
- 這些命中可能不直接與調查的事件相關
- IOC 可能過於通用

#### 處理方式:
- 識別並消除誤報 (False Positives)
- 若命中數量龐大，應優先處理能提供新線索的系統
- 理想上選擇鑑識分析後能提供新線索的系統

### 8.6 資料收集與分析

#### 收集方式:

**即時回應 (Live Response)**:
- 最常見方式
- 在系統運行時收集預定義的豐富資料集
- 可能解釋系統發生了什麼

**系統關機**:
- 不易決定
- 許多重要工件僅存在於 RAM 記憶體中
- 關機會失去這些工件

#### 重要原則:
- 確保與系統的互動最小化
- 避免改變任何證據或工件
- 保持監管鏈 (Chain of Custody) 記錄
- 確保檢查的資料可在法庭上採納

#### 分析類型:
- 惡意軟體分析
- 磁碟鑑識
- 記憶體鑑識 (越來越流行，對付進階攻擊極為相關)

#### 持續更新時間軸:
- 任何新發現並驗證的線索加入時間軸
- 時間軸持續更新

### 8.7 AI 在威脅偵測中的應用

#### AI 的轉型作用:
- 自動化大部分分析工作
- 減少回應時間
- 從歷史事件學習
- 比人類更快識別行為異常

#### 範例: Elastic Security 的 "Attack Discovery"
- 使用生成式 AI (LLMs) 分析數千個偵測事件
- 將相關警報總結並聚類成攻擊故事
- 顯示多個警報之間的關係
- 識別涉及的使用者和主機
- 顯示 MITRE ATT&CK 映射

#### AI 在事件回應中的用例:
1. **自動化分流與警報優先級**
2. **事件關聯與時間軸重建**
3. **自動化回應劇本**
4. **事後分析與學習的 AI 輔助**

---

## 九、圍堵、根除與恢復階段

### 9.1 階段流程

```
調查完成 → 圍堵策略 → 證據收集 → 識別攻擊主機 → 根除與恢復 → 恢復正常運作
```

### 9.2 圍堵 (Containment)

#### 目的:
- 採取行動防止事件擴散
- 行動分為短期圍堵和長期圍堵
- **重要**: 圍堵行動必須協調並在所有系統上同時執行

#### 短期圍堵:
**特點**: 對系統留下最小足跡

**行動範例**:
- 將系統放置在獨立/隔離的 VLAN
- 拔除系統網路線
- 修改攻擊者的 C2 DNS 名稱至:
  - 我方控制的系統
  - 不存在的系統
- 取得鑑識映像並保存證據 (備份子階段)

**注意事項**:
- 若需關閉系統，必須與業務溝通並獲得適當許可

#### 長期圍堵:
**特點**: 專注於持久性行動和變更

**行動範例**:
- 變更使用者密碼
- 套用防火牆規則
- 插入主機入侵偵測系統
- 套用系統修補程式
- 關閉系統

**重要提醒**:
- 保持業務和相關利害關係人的資訊更新
- 系統修補不代表事件結束
- 根除、恢復和事後活動仍待處理

### 9.3 根除 (Eradication)

#### 目的:
消除事件的根本原因和殘留，確保攻擊者離開系統和網路

#### 活動:
- 從系統移除偵測到的惡意軟體
- 重建某些系統
- 從備份還原其他系統
- 套用之前未立即需要的額外修補程式
- 執行額外的系統強化活動:
  - 不僅在受影響系統上
  - 在某些情況下擴及整個網路

### 9.4 恢復 (Recovery)

#### 目的:
將系統恢復正常運作

#### 流程:
1. 業務驗證系統是否如預期運作
2. 確認系統包含所有必要資料
3. 驗證完成後，將系統帶入生產環境

#### 恢復後監控:
**重點**: 所有還原的系統將受到密集日誌記錄和監控

**監控的可疑事件**:
- 異常登入 (例如從未在該處登入的使用者或服務帳號)
- 異常程序
- 登錄檔位置的變更 (通常由惡意軟體修改的位置)

#### 時程:
- 某些大型事件的恢復階段可能需要數月
- 通常採用分階段方式:
  - **早期階段**: 專注於透過快速勝利和消除低掛果實來提高整體安全性
  - **後期階段**: 專注於永久性、長期的變更以保持組織盡可能安全

#### ⚠️ 重要決策:
若在恢復期間仍斷斷續續觀察到 IOCs，應:
- **升級回調查階段** (而非繼續恢復)
- 表示根除不完全

---

## 十、事件後活動階段 (Post-Incident Activity)

### 10.1 階段流程

```
事件解決
    ↓
事後審查
    ↓
經驗教訓會議
    ↓
根本原因分析
    ↓
更新政策與劇本
    ↓
增強偵測與監控規則
    ↓
知識分享與意識提升
    ↓
向管理層報告並結案
```

### 10.2 目的

- 記錄事件
- 基於經驗教訓改進能力
- 反思威脅，了解發生什麼、做了什麼、行動效果如何
- 通常在事件結案後幾天內舉行會議
- 涉及所有利害關係人

### 10.3 報告 (Reporting)

#### 最終報告應回答的問題:

1. **事件本身**:
   - 發生了什麼？何時發生？

2. **團隊表現**:
   - 團隊在處理事件時的表現如何？
   - 計劃、劇本、政策和程序的執行情況？

3. **業務回應**:
   - 業務是否提供必要資訊？
   - 是否及時回應以有效處理事件？
   - 可以改進什麼？

4. **行動記錄**:
   - 實施了哪些行動來圍堵和根除事件？

5. **預防措施**:
   - 應採取哪些預防措施來防止類似事件？

6. **資源需求**:
   - 需要哪些工具和資源來偵測和分析類似事件？

### 10.4 報告的價值

#### 可衡量的結果:
- 處理了多少事件
- 每個事件團隊花費多少時間
- 處理過程中執行的不同行動

#### 其他價值:
- 提供處理未來類似事件的參考
- 在法律訴訟情況下使用
- 識別事件的成本和影響來源

### 10.5 持續改進

#### 團隊訓練:
- 向新團隊成員展示更有經驗的同事如何處理事件
- 極佳的訓練場所

#### 評估與更新:
- 評估是否需要更新:
  - 計劃
  - 劇本
  - 政策
  - 程序
- 重新評估:
  - 工具
  - 訓練
  - 團隊準備度
  - 整體團隊結構

**重點**: 不僅專注於文件和流程，還要關注團隊能力建設

---

## 十一、真實世界事件類型

### 11.1 洩露憑證 (Leaked Credentials)

#### Colonial Pipeline 勒索軟體攻擊
- **目標**: 美國主要石油管道系統
- **起因**: 員工個人密碼洩露 (可能在暗網發現)
- **入侵點**: 非活躍 VPN 帳號的受損密碼
- **弱點**: 未啟用多因素驗證 (MFA)

### 11.2 預設/弱憑證 (Default/Weak Credentials)

#### Mirai 殭屍網路 (2016)
- **手法**: 掃描使用出廠或預設憑證的 IoT 裝置 (例如 admin/admin)
- **結果**: 徵召大量裝置建立大規模 DDoS 殭屍網路
- **影響**: 影響 Dyn 和 OVH 等公司，數十萬裝置感染
- **根本原因**: 裝置出廠時未變更預設憑證，遠端存取安全性差

#### LogicMonitor 事件 (2023)
- **問題**: 廠商向客戶帳號發放弱預設密碼
- **結果**: 受影響客戶遭受勒索軟體或未授權存取
- **根本原因**: 廠商指定的弱/預設憑證，延遲執行密碼強化

### 11.3 過時軟體/未修補系統

#### Equifax 洩露事件 (2017)
- **漏洞**: Apache Struts 已知漏洞 (CVE-2017-5638)
- **影響**: 約 1.43-1.47 億人的個人資料洩露
- **後果**: 重大監管和法律後果
- **原因**: 未能及時套用公開發布的修補程式

#### WannaCry 勒索軟體 (2017)
- **傳播方式**: 使用 SMB EternalBlue 漏洞以蠕蟲方式傳播
- **規模**: 超過 150 個國家的 20 萬個系統受影響
- **高影響**: 醫院和企業
- **原因**: Windows 系統未修補，儘管 MS17-010 修補程式在爆發前已發布

### 11.4 流氓員工/內部威脅

#### Cash App / Block Inc. (2021 披露; 2022 公開通知)
- **事件**: 前員工存取數百萬 Cash App 使用者的個人資訊
- **影響**: 約 820 萬名現任和前任客戶可能受影響
- **後果**: 監管審查和和解
- **根本原因**: 
  - 濫用合法員工存取權限
  - 內部控制和監控不足

### 11.5 釣魚/社交工程

#### 整體趨勢:
- 釣魚是普遍的攻擊向量
- 用於獲取憑證、傳遞惡意軟體或欺騙使用者啟用遠端存取
- 經常導致帳號入侵、詐騙和網路據點
- 多年來大量洩露事件與釣魚有關

#### 美國內政部釣魚攻擊
- **手法**: 使用「邪惡雙胞胎」技術
- **方式**: 誘騙個人連線到假 Wi-Fi 網路
- **結果**: 駭客竊取憑證並存取網路
- **暴露問題**:
  - 缺乏安全無線網路基礎設施
  - 安全措施不足
  - 使用者認證薄弱
  - 網路測試不足

#### 2020 Twitter 帳號劫持
- **事件**: 許多高知名度 Twitter 帳號被外部方入侵
- **目的**: 推廣比特幣詐騙
- **手法**: 
  - 獲得 Twitter 管理工具的存取權限
  - 可以變更帳號並直接發布推文
  - 似乎使用社交工程透過 Twitter 員工獲得工具存取權限

### 11.6 供應鏈攻擊

#### SolarWinds Orion (2020)
- **攻擊者**: 國家級行為者
- **手法**: 入侵 SolarWinds 建置/發布環境
- **方式**: 將惡意後門注入 Orion 更新
- **分發**: 分發給數千名客戶
- **影響**: 
  - 政府和私營部門廣泛的間諜活動和未授權存取
  - 導致長期的偵測和補救工作

---

## 十二、事件報告範例與框架

### 12.1 專業事件報告

#### 報告來源:
- Mandiant
- Palo Alto Unit 42
- Proofpoint
- DFIR Labs

#### 報告格式:
按順序、分階段記錄真實世界安全事件，與以下框架對應:
- Cyber Kill Chain
- MITRE ATT&CK 框架

#### 報告結構:
從初始存取到影響，每個部分代表攻擊者操作的不同階段

### 12.2 事件特定報告範例

#### DFIR Labs: "Confluence Exploit Leads to LockBit Ransomware"
- 順序記錄事件發現
- 每個部分代表攻擊者操作的不同階段
- 從初始存取和執行到滲透和影響
- 說明攻擊如何在環境中進展

#### Cybereason: "CHAES: Novel Malware Targeting Latin American E-Commerce"
- 專注於特定事件或爆發
- 逐步說明發生了什麼
- 包含: 攻擊者如何獲得存取、做了什麼、如何被偵測、影響是什麼

### 12.3 全球事件回應報告

#### Unit 42 2025 報告特點:
- 彙總數百起事件的資料
- 跨越各種產業、地理位置和威脅行為者
- 識別趨勢、模式、新興威脅
- 提供統計洞察和高階建議

#### 重要發現範例:
- "2024 年，Unit 42 回應的 86% 事件涉及業務中斷 - 包括運營停機、聲譽損害或兩者兼有"
- "軟體供應鏈和雲端攻擊在頻率和複雜度上都在增長。在一次活動中，攻擊者掃描了超過 2.3 億個獨特目標以尋找敏感資訊"

---

## 十三、案例研究: Insight Nexus 洩露事件分析

### 13.1 受害者背景

**Insight Nexus 公司資訊**:
- 中型市場研究和資料分析公司
- 總部: 新加坡
- 業務: 為全球客戶提供競爭情報和消費者洞察
- 客戶: 包括 IT 和金融領域的財富 500 強公司

### 13.2 環境架構

#### 面向公眾的資產:
- **manage.insightnexus.com**: ManageEngine ADManager Plus
  - Active Directory 管理的網頁應用程式
  - HTTPS (port 443) 可從網際網路存取
- **portal.insightnexus.com**: PHP 客戶報告入口網站
  - 啟用檔案上傳功能

#### 內部環境:
- **網域控制器**: DC01.insight.local
- **檔案伺服器**: FS01.insight.local (檔案共享: \\fs01\projects)
- **資料庫伺服器**: DB01.insight.local (含敏感資料庫)
- **工作站**: 開發者車隊 (DEV-001 到 DEV-120)
  - DEV-021: 配置錯誤，允許外部 RDP 連線

#### 安全措施:
- 邊界防火牆 (預設日誌記錄，無威脅情報整合)
- 基本 IDS (高誤報率)
- 大多數 Windows 主機上的 Wazuh 代理 (部分覆蓋)
- 集中式 SIEM (Wazuh)
  - 攝取: Windows Sysmon、Windows Security、網頁伺服器日誌、防火牆日誌
  - 限制: 有限的保留期
- TheHive 用於案例管理
- Cortex 可用於豐富化

### 13.3 威脅行為者

#### Crimson Fox (主要威脅行為者)
- **背景**: 
  - 與 IT 產業供應鏈攻擊有關
  - 疑似國家支持
- **專長**: 
  - 憑證竊取
  - 長期持久化
  - 資料滲透
- **能力**: 有能力且持續的團隊，以往多次成功攻擊

#### Silent Jackal (次要行為者)
- **組織**: 鬆散組織的犯罪團體
- **焦點**: 機會主義網站竄改和概念驗證入侵
- **動機**: 不一定是經濟動機，但具破壞性
- **成員**: 低技能網頁入侵者

### 13.4 攻擊時間軸與分析

#### 2025-10-01 03:12:02 - 初始存取 (Crimson Fox)
**入侵點**: ManageEngine ADManager Plus
- 攻擊者使用預設憑證 admin/admin 成功登入
- 管理員在產品更新後忘記變更預設憑證
- 透過 HTTPS 進行互動式網頁登入

**組織疏忽**:
- 儘管有廠商建議，預設憑證從未變更
- 未強制執行多因素驗證
- 端點上無 WAF 檢查
- 網頁應用程式登入事件未發送到集中式 SIEM

**偵測缺口**: 
- 關於伺服器上建立新檔案的警報太多
- 由於警報疲勞，此警報未升級
- 需要減少誤報並新增更多篩選器

#### 2025-10-01 03:18:32 - 命令與控制
**活動**: 利用 Java 網頁漏洞 (ManageEngine ADManager Plus)
- 未經身份驗證的遠端程式碼執行
- 建立到 103.112.60.117 的出站 C2 (攻擊者控制的雲端主機)
- 透過 HTTPS 偽裝成更新流量

**Sysmon Event ID 3** (偵測到網路連線):
```
UtcTime: 2025-10-01 03:18:32.557
Image: C:\ManageEngine\jre\bin\java.exe
DestinationIp: 103.112.60.117
DestinationPort: 443
```

#### 2025-10-02 04:02:11 - 偵察與權限提升
**活動**:
- 從 ManageEngine 主控台列舉網域使用者和電腦
- 建立新的網域管理員帳號
- 在 Active Directory 列舉期間發現:
  - Windows 10 機器 (DEV-021) 有公開的 RDP 埠
  - 此桌面機器由開發者偶爾使用

#### 2025-10-04 02:03:12 - 橫向移動
**活動**: 使用新建立的網域管理員帳號直接 RDP 到 DEV-021

**Windows Event ID 4624** (帳號成功登入):
```
Subject:
    Security ID: SYSTEM
    Account Name: DEV-021$
    Time: 2025-10-04T02:03:12Z

Logon Information:
    Logon Type: 10

Network Information:
    Source Network Address: 103.112.60.117

New Logon:
    SubjectUserName: insight\svc_deployer
```

**偵測缺口**: 
- 未建立針對這些公開 IP RDP 事件產生警報的規則
- 可使用 Sigma 規則偵測 (External Remote RDP Logon from Public IP)

#### 網域偵察與資料存取
**活動**:
- 在檔案伺服器上發現有趣的檔案共享
- 多次嘗試存取
- 找到包含客戶專案資料夾的內容:
  - 草稿報告
  - 調查資料
  - 市場預測

**Event ID 5140**(S, F): 存取網路共享物件
- 有多個事件日誌被建立
- 未針對敏感資料存取建立警報規則

#### 資料滲透
**活動**: 壓縮並滲透選定資料
- 將竊取的客戶資料打包成 `diagnostics_data.zip`
- 檔案名稱選擇看起來像例行遙測資料
- 透過 HTTPS 上傳到攻擊者控制的主機

**為何未被立即發現**:
- 檔案名稱類似合法診斷資料
- 使用標準 HTTPS 上傳
- 增加攻擊者在防禦者升級前滲透資料的機會

#### 2025-10-04 02:10:45 - 部署惡意軟體
**活動**: 從 DEV-021 執行 PowerShell 腳本
- 使用網域管理員憑證
- 建立群組原則物件 (GPO)
- 跨網域推送 MSI 套件 (java-update.msi)
- MSI 套件建立排程任務
- 執行具有間諜和資料滲透能力的程序

**Sysmon Event ID 11** (檔案建立):
```
TargetFilename: C:\Windows\Temp\java-update.msi
```

**Sysmon Event ID 1** (程序建立):
```
Image: C:\Windows\System32\msiexec.exe
CommandLine: "msiexec /i C:\Windows\Temp\java-update.msi /quiet"
```

**結果**: 透過 GPO 在所有網域機器上部署具有間諜和資料滲透能力的惡意軟體

#### Silent Jackal 的活動
**時間**: 大約同一時間
**目標**: PHP 客戶報告入口網站

**活動**:
- 利用未修補的檔案上傳漏洞
- 在網頁伺服器根目錄上傳 `checkme.txt` 檔案
- 內容: "SilentJackal was here" (簽名)
- 活動似乎僅限於留下標記檔案

**意義**:
- 在環境中製造雜訊
- 提供防禦者入侵的第一個線索
- 可能是低技能入侵，意在表明存在而非造成立即損害

**組織疏忽**: 
- 無網頁應用程式防火牆監控
- 面向網際網路的入口網站無定期弱點評估

### 13.5 初始事件回應行動

#### 發現:
首個具體發現是 SOC 分析師發現的 `checkme.txt`
- 通常優先級低
- 但 SOC 分析師進行關聯分析
- 發現同一時間窗口有:
  - ManageEngine 事件
  - 異常出站流量
  - 來自不熟悉外國 IP 的多次登入事件

#### 關聯分析:
- ManageEngine 從外國 IP 成功的管理員登入
- Sysmon 程序建立: msiexec 在許多主機上安裝 MSI
- LDAP 列舉日誌和 GPO 變更
- 檔案伺服器檔案壓縮和上傳日誌
- 到異常 IP 位址的出站 HTTPS

#### 升級與案例建立:
SOC 分析師立即將事件升級給事件回應團隊，並在 TheHive 開啟案例

**案例標題**: "Insight Nexus – ManageEngine Compromise"
**連結的警報**: 
- ManageEngine 管理員登入
- Sysmon msiexec 事件
- LDAP 列舉
- 檔案伺服器上傳
- 入口網站 checkme.txt 事件

**角色分配**:
- 分流分析師 (Triage Analyst)
- 鑑識負責人 (Forensics Lead)
- 圍堵負責人 (Containment Lead)
- 通訊負責人 (Communications Lead)

**優先級**: 關鍵 (Critical) - 確認資料滲透

### 13.6 圍堵措施

#### 網路控制:
- 在邊界防火牆和主機防火牆阻擋到 103.112.60.117 的出站流量
- 為攻擊者 IP 新增臨時出口阻擋規則
- 新增 IDS 簽章以警示到 103.112.60.117 和類似端點的連線

#### 憑證與帳號行動:
- 停用 ManageEngine 管理員帳號
- 輪換日誌中暴露的所有高權限憑證:
  - 服務帳號
  - 部署者帳號
  - 任何顯示可疑活動的帳號
- 限制 ManageEngine 網頁主控台僅限內部存取
- 強制變更密碼
- 立即撤銷活動 session (若可能)

#### 主機隔離:
- 隔離以下系統以進行鑑識收集:
  - manage.insightnexus.com
  - DEV-021
  - 任何顯示 MSI 安裝證據的機器
- 阻擋網路存取，但以允許分析的方式保存
- 暫停排程任務
- 停用 GPO 啟動的部署，直到確認補救

#### 收集鑑識工件:
**隔離主機上收集**:
- 揮發性記憶體
- 程序清單
- 登錄檔 hives
- 磁碟映像
- 匯出 ManageEngine 稽核日誌
- 具有完整時間戳記的網頁伺服器存取日誌

**保存副本**:
- MSI 檔案 (java-update.msi)
- 壓縮的滲透套件 (diagnostics_data.zip)
- 在管理應用程式目錄中發現的任何網頁 shell 檔案

### 13.7 MITRE ATT&CK 映射

| 戰術 | 技術 | ID | 描述 |
|------|------|-----|------|
| 初始存取 | Exploit Public-Facing Application | T1190 | 利用 Confluence CVE |
| 執行 | Command and Scripting Interpreter: PowerShell | T1059.001 | 使用 PowerShell 下載 payload |
| 持久化 | Windows Service | T1543.003 | Windows 服務持久化 |
| 憑證存取 | LSASS Memory Dumping | T1003.001 | 提取憑證 |
| 橫向移動 | Remote Desktop Protocol | T1021.001 | RDP 橫向移動 |
| 影響 | Data Encrypted for Impact | T1486 | LockBit 勒索軟體 |
| 工具傳輸 | Ingress Tool Transfer | T1105 | 從 C2 下載工具 |
| 憑證竊取 | Credentials from Password Stores | T1555 | VaultCli.dll 模組 |

### 13.8 經驗教訓

1. **預設憑證**: 面向網際網路應用程式上的預設憑證仍是最簡單但最具破壞性的疏忽之一

2. **多個威脅行為者**: 單一環境中可能存在多個並行的威脅行為者，具有不同動機
   - 一個機會主義
   - 一個高度針對性
   - 這使回應複雜化，因為防禦者若只看到「吵鬧」的入侵者可能低估嚴重性

3. **警報關聯**: 跨團隊關聯警報失敗會延遲圍堵，使進階行為者有更多時間達成目標

4. **事後監控**: 必須包括掃描持久化機制，因為刪除攻擊者的標記檔案並不能消除根本原因

5. **持續改進**: 需要更新政策、劇本和技術控制以防止類似事件

---

## 十四、TheHive 案例管理平台

### 14.1 平台概述

**TheHive** 是專為網路安全團隊設計的案例管理平台:
- 透過處理警報有效處理事件
- 建立案例並連結多個相關警報
- 作為集中中心收集和管理所有安全警報
- 從各種裝置整合到單一頁面

### 14.2 MITRE ATT&CK 整合

**功能**:
- 可以將所有 MITRE ATT&CK 框架的戰術、技術和程序 (TTPs) 匯入警報管理系統
- 透過將發現的攻擊模式與警報關聯來豐富事件分析

**存取資訊**:
- URL: `http://TARGET_IP:9000`
- 使用者名稱: htb-analyst
- 密碼: P3n#31337@LOG

### 14.3 警報管理

**功能**:
- 檢視和管理警報
- 將警報分配給分析師
- 查看警報描述和摘要
- 新增 Observables (可觀察項)
- 連結 TTPs
- 建立案例

**Observables (可觀察項) 類型**:
- autonomous-system
- domain
- file
- filename
- fqdn
- hash
- hostname
- ip

**可觀察項功能**:
- 標記為 IOC (Indicator of Compromise)
- 新增標籤
- 新增描述
- 設定 TLP 和 PAP 標記

### 14.4 案例工作流程

1. **接收警報**: 從 SIEM 或其他來源
2. **分配警報**: 將警報分配給分析師
3. **建立案例**: 將相關警報連結到案例中
4. **新增詳情**: 在案例中記錄事件詳情
5. **調查**: 執行分析和豐富化
6. **記錄發現**: 在案例中記錄所有發現和經驗教訓
7. **結案**: 完成調查後關閉案例

---

## 十五、實用偵測規則

### 15.1 Sigma 規則範例

#### 外部遠端 RDP 登入偵測

```yaml
title: External Remote RDP Logon from Public IP
id: 259a9cdf-c4dd-4fa2-b243-2269e5ab18a2
status: test
description: 偵測從公開 IP 位址透過 RDP 成功登入。這可能表示公開暴露的 RDP 埠。
references:
    - https://www.inversecos.com/2020/04/successful-4624-anonymous-logons-to.html
    - https://twitter.com/Purp1eW0lf/status/1616144561965002752
author: Micah Babinski (@micahbabinski), Zach Mathis (@yamatosecurity)
date: 2023-01-19
modified: 2024-03-11
tags:
    - attack.initial-access
    - attack.credential-access
    - attack.t1133
    - attack.t1078
    - attack.t1110
logsource:
    product: windows
    service: security
detection:
    selection:
        EventID: 4624
        LogonType: 10
    filter_main_local_ranges:
        IpAddress|cidr:
            - '::1/128'  # IPv6 loopback
            - '10.0.0.0/8'
            - '127.0.0.0/8'
            - '172.16.0.0/12'
            - '192.168.0.0/16'
            - '169.254.0.0/16'
            - 'fc00::/7'  # IPv6 private addresses
            - 'fe80::/10'  # IPv6 link-local addresses
    filter_main_empty:
        IpAddress: '-'
    condition: selection and not 1 of filter_main_*
falsepositives:
    - 合法或故意從公開 IP 位址在 RDP 埠上的入站連線
level: medium
```

### 15.2 關鍵 Windows Event IDs

#### Event ID 4624 - 帳號成功登入
- **Logon Type 2**: 互動式登入 (本地鍵盤/螢幕)
- **Logon Type 3**: 網路登入 (不快取憑證)
- **Logon Type 10**: RemoteInteractive (RDP)

#### Event ID 4688 - 新程序已建立
- 追蹤程序建立
- 包含命令列參數 (若啟用)
- 可識別惡意工具執行

#### Event ID 5140 - 存取網路共享物件
- 追蹤檔案共享存取
- 可偵測異常資料存取模式

#### Sysmon Event ID 1 - 程序建立
- 比 Event ID 4688 更詳細
- 包含完整命令列
- 記錄父程序資訊

#### Sysmon Event ID 3 - 網路連線
- 追蹤網路連線
- 識別 C2 通訊
- 包含目的地 IP 和埠

#### Sysmon Event ID 11 - 檔案建立
- 追蹤檔案建立事件
- 可偵測惡意檔案放置

---

## 十六、實戰技能評估檢核表

### 16.1 警報分流 (Alert Triage)

- [ ] 在 TheHive 中建立新案例
- [ ] 找到所有與 Insights Nexus 洩露情境相關的警報
- [ ] 將警報連結到案例中
- [ ] 執行分流、豐富化和關聯
- [ ] 在警報的備註中新增有用的資訊

### 16.2 威脅情報豐富化

- [ ] 檢查警報中的外國 IP 位址
- [ ] 在 VirusTotal 檢查 IP 資訊
- [ ] 將詳情作為註釋新增到警報中
- [ ] 識別相關檔案 (例如 "Mango" 開頭的檔案)
- [ ] 查詢 Whois 資訊

### 16.3 Cyber Kill Chain 映射

- [ ] 識別攻擊階段:
  - 檔案下載
  - 登錄檔修改
  - 憑證滲透活動
- [ ] 映射到 MITRE ATT&CK 技術
- [ ] 檢查 Mimikatz 相關警報
- [ ] 識別 MITRE 技術 ID

### 16.4 日誌分析

- [ ] 下載並分析事件日誌檔案
- [ ] 解碼可疑的 PowerShell 命令
- [ ] 從命令中提取 IOCs
- [ ] 識別執行命令的使用者
- [ ] 驗證網路連線 (netstat 輸出)
- [ ] 識別持久化機制
- [ ] 追蹤滲透活動

### 16.5 具體調查任務

#### 憑證洩露:
- [ ] 檢查 Event ID 4688
- [ ] 驗證執行憑證傾印工具的父程序完整路徑
- [ ] 答案格式: `C:\Pr........`

#### 持久化機制:
- [ ] 識別顯示持久化機制的事件
- [ ] 找出主機 DB01 上的 imagePath 值
- [ ] 檢查服務安裝

#### 資料滲透:
- [ ] 識別檔案上傳或出站流量
- [ ] 找出 `diagnostics_data.zip` 上傳的外部 IP
- [ ] 追蹤檔案存取模式

#### 使用者活動:
- [ ] 識別嘗試連線到檔案共享 `\\fs01\projects` 的使用者

---

## 十七、重要參考資源

### 17.1 標準與指南

- **NIST Computer Security Incident Handling Guide**
  - 提供實用指南以有效處理事件
  - 協助組織降低電腦安全事件的風險

### 17.2 威脅情報

- **CISA (Cybersecurity and Infrastructure Security Agency)**
  - 發布 STIX 格式的 IOCs
  - 提供威脅情報分享

- **MITRE ATT&CK**
  - URL: https://attack.mitre.org/matrices/enterprise/
  - 企業攻擊矩陣
  - 戰術和技術知識庫

### 17.3 事件報告來源

- **The DFIR Report**
  - URL: https://thedfirreport.com/
  - 詳細的事件分析報告
  - 真實世界攻擊案例

- **Palo Alto Unit 42**
  - 全球事件回應報告
  - 威脅趨勢分析

- **Mandiant**
  - 專業事件回應報告
  - APT 團隊分析

- **Cybereason**
  - 惡意軟體分析報告
  - 威脅研究

### 17.4 工具與平台

- **TheHive**
  - 案例管理平台
  - 警報管理
  - MITRE ATT&CK 整合

- **Cortex**
  - 可觀察項豐富化
  - 整合多種分析器

- **Elastic Security**
  - Attack Discovery (AI 驅動)
  - 偵測和回應

- **Wazuh**
  - SIEM 平台
  - 主機基礎的入侵偵測

### 17.5 標準與語言

- **OpenIOC**
  - IOC 文件標準

- **YARA**
  - 惡意軟體識別規則

- **STIX** (Structured Threat Information eXpression)
  - 開源、機器可讀
  - 主要使用 JSON 格式
  - 交換網路威脅情報

- **Sigma**
  - 通用簽章格式
  - 日誌事件偵測規則

---

## 十八、關鍵要點與最佳實踐

### 18.1 事件處理核心原則

1. **準備是關鍵**
   - 建立完善的政策和程序
   - 準備 Jump Bag
   - 定期進行演練

2. **保持冷靜和系統化**
   - 遵循既定流程
   - 不要跳過步驟
   - 做好記錄

3. **時間軸是核心**
   - 按時間順序組織證據
   - 持續更新
   - 提供事件全貌

4. **協調圍堵**
   - 所有行動必須同時進行
   - 避免驚動攻擊者
   - 區分短期和長期措施

5. **假設最壞情況**
   - 假設整個網域已被入侵
   - 使用獨立的通訊管道
   - 保護高權限憑證

### 18.2 常見錯誤與陷阱

❌ **避免的錯誤**:
- 跳過調查階段直接進入恢復
- 部分圍堵 (只圍堵部分受影響系統)
- 在調查期間使用會快取憑證的工具
- 忽略低優先級警報
- 缺乏適當的記錄
- 單獨工作，缺乏溝通

✓ **應該做的**:
- 完成每個階段後再進入下一階段
- 同時在所有系統上執行圍堵
- 使用不會快取憑證的工具 (如 WinRM)
- 進行適當的警報關聯
- 保持詳細的時間軸和記錄
- 保持團隊溝通

### 18.3 技術能力要求

**必備技能**:
- Windows 日誌分析
- 網路流量分析
- 惡意軟體分析基礎
- 鑑識技術
- MITRE ATT&CK 框架理解
- 腳本和自動化能力

**進階技能**:
- 記憶體鑑識
- 逆向工程
- 威脅狩獵
- AI/ML 輔助分析

### 18.4 持續改進

1. **事後審查**
   - 每次事件後進行
   - 涉及所有利害關係人
   - 識別改進機會

2. **更新文件**
   - 劇本
   - 程序
   - 偵測規則

3. **團隊訓練**
   - 定期演練
   - 紫隊演習
   - 案例研究學習

4. **工具評估**
   - 評估現有工具效能
   - 識別缺口
   - 採用新技術 (如 AI 輔助分析)

---

## 附錄

### A. 縮寫對照表

- **AD**: Active Directory (活動目錄)
- **APT**: Advanced Persistent Threat (進階持續性威脅)
- **ASR**: Attack Surface Reduction (攻擊面縮減)
- **C2**: Command and Control (命令與控制)
- **CISO**: Chief Information Security Officer (資訊安全長)
- **CIO**: Chief Information Officer (資訊長)
- **CTI**: Cyber Threat Intelligence (網路威脅情報)
- **CVE**: Common Vulnerabilities and Exposures (常見漏洞和曝險)
- **DDoS**: Distributed Denial of Service (分散式阻斷服務)
- **DFIR**: Digital Forensics and Incident Response (數位鑑識與事件回應)
- **DMZ**: Demilitarized Zone (非軍事區)
- **DMARC**: Domain-based Message Authentication, Reporting and Conformance
- **EDR**: Endpoint Detection and Response (端點偵測與回應)
- **GDPR**: General Data Protection Regulation (一般資料保護規範)
- **GPO**: Group Policy Object (群組原則物件)
- **IDS**: Intrusion Detection System (入侵偵測系統)
- **IH**: Incident Handling (事件處理)
- **IOC**: Indicator of Compromise (入侵指標)
- **IP**: Internet Protocol (網際網路協定)
- **IPS**: Intrusion Prevention System (入侵防禦系統)
- **ISP**: Internet Service Provider (網際網路服務供應商)
- **LAPS**: Local Administrator Password Solution
- **LOLBin**: Living Off the Land Binaries
- **MFA**: Multi-Factor Authentication (多因素驗證)
- **MITRE ATT&CK**: MITRE Adversarial Tactics, Techniques, and Common Knowledge
- **NIST**: National Institute of Standards and Technology
- **RDP**: Remote Desktop Protocol (遠端桌面協定)
- **SIEM**: Security Information and Event Management (安全資訊與事件管理)
- **SMB**: Server Message Block
- **SOC**: Security Operations Center (安全營運中心)
- **SPF**: Sender Policy Framework
- **STIX**: Structured Threat Information eXpression
- **TLP**: Traffic Light Protocol (交通燈協定)
- **TTP**: Tactics, Techniques, and Procedures (戰術、技術和程序)
- **VPN**: Virtual Private Network (虛擬私人網路)
- **WAF**: Web Application Firewall (網頁應用程式防火牆)
- **YARA**: Yet Another Recursive Acronym

### B. 快速參考卡

#### 事件處理四階段
1. 準備 → 2. 偵測與分析 → 3. 圍堵、根除與恢復 → 4. 事後活動

#### Cyber Kill Chain 七階段
1. 偵察 → 2. 武器化 → 3. 傳遞 → 4. 漏洞利用 → 5. 安裝 → 6. 命令與控制 → 7. 行動

#### 時間軸欄位
日期 | 時間 | 主機名稱 | 事件描述 | 資料來源

#### 5W1H 記錄原則
Who | What | When | Where | Why | How

---

**文件版本**: 1.0  
**最後更新**: 2025-12-24  
**來源**: HTB Academy - Incident Handling Process Module
